<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - CalPed</title>
    <link rel="stylesheet" href="css/stylestruste2.css">
    <!-- Adicionar o SDK do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="js/configfirebase.js"></script>
</head>
<body>
    <header id="home">
        <img src="img/header-banner.jpg" alt="Banner do CalPed" class="responsive-image"> 
        <h1>Login</h1>
        <p>Acesse a calculadora.</p>
    </header>
    <nav class="main-nav">
        <button class="menu-toggle" aria-expanded="false" aria-label="Menu">
            ☰
        </button>
        <ul id="menu">
            <li><a href="index.html">Home</a></li>
            <li><a href="reset-password.html">Redefinir senha</a></li>
            <li><a href="contact.html">Contato</a></li>
            <li><a href="about.html">Sobre</a></li> 
        </ul>
    </nav>
    <main>
        <section id="login">
            <h2>Faça Login para Acessar as Calculadoras</h2>
            <form id="loginForm">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
                
                <label for="password">Senha:</label>
                <input type="password" id="password" name="password" required>
                
                <button type="submit">Login</button>
            </form>
            <div id="loginMessage"></div>
            <button class="reset-button" onclick="window.location.href='reset-password.html'">Esqueceu a Senha?</button>
        </section>
    </main>
    <footer>
        <p>&copy; <span id="copyright-year"></span> CalPed. Todos os direitos reservados. | <a href="mailto:calculospediatricos@gmail.com">calculospediatricos@gmail.com</a></p>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const startYear = 2017;
            const currentYear = new Date().getFullYear();
            const yearText = (currentYear > startYear) ? `${startYear} - ${currentYear}` : `${startYear}`;
            document.getElementById('copyright-year').textContent = yearText;
        });
    </script>
    <!-- Adicionar o script de login -->
    <script src="js/configfirebase.js"></script>
    <script src="js/checkTerms.js"></script> <!-- Script para verificar termos -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const auth = firebase.auth();
            const loginForm = document.getElementById('loginForm');
            const loginMessage = document.getElementById('loginMessage');

            loginForm.addEventListener('submit', function(event) {
                event.preventDefault();

                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        loginMessage.style.color = 'green';
                        loginMessage.textContent = 'Login bem-sucedido!';
                        checkTerms(); // Verificar termos após login bem-sucedido
                    })
                    .catch((error) => {
                        loginMessage.style.color = 'red';
                        switch (error.code) {
                            case 'auth/invalid-email':
                                loginMessage.textContent = 'Email inválido.';
                                break;
                            case 'auth/user-disabled':
                                loginMessage.textContent = 'Usuário desativado.';
                                break;
                            case 'auth/user-not-found':
                                loginMessage.textContent = 'Usuário não encontrado.';
                                break;
                            case 'auth/wrong-password':
                                loginMessage.textContent = 'Senha incorreta.';
                                break;
                            default:
                                loginMessage.textContent = 'Erro ao fazer login.';
                                break;
                        }
                    });
            });

            auth.onAuthStateChanged((user) => {
                if (user) {
                    if (window.location.pathname.endsWith('login.html')) {
                        checkTerms(); // Verificar termos se o usuário já está logado
                    }
                } else {
                    if (window.location.pathname.endsWith('calculadora.html')) {
                        window.location.href = 'login.html';
                    }
                }
            });
        });
    </script>
</body>
</html>
